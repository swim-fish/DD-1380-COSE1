<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DD Form 1380 TCCC Êï∏‰ΩçÁ∞ΩÁ´† QR Code Á≥ªÁµ±</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

    <!-- ÂºïÂÖ•Â§ñÈÉ® CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Â§ñÈÉ®ÂáΩÂºèÂ∫´ (‰øùÊåÅ‰∏çËÆä) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/3.45.1/minified.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.21.3/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cbor-x@1.6.0/dist/index.min.js"></script>
    
</head>
<body>
    <div id="videoContainer" style="display: none;">
        <video id="video"></video>
        <button onclick="stopCamera()" style="margin-top: 20px; background: #e53e3e;">ÈóúÈñâÁõ∏Ê©ü</button>
    </div>

    <div class="container">
        <h1>DD Form 1380 TCCC Êï∏‰ΩçÁ∞ΩÁ´† QR Code Á≥ªÁµ±</h1>
        
        <div class="card">
            <form id="tcccForm">
                <div class="form-section" style="background: #f0f9ff; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                    <h3 style="text-align: center; color: #0369a1; margin-bottom: 15px;">Âø´ÈÄüÊìç‰Ωú</h3>
                    <div class="button-group">
                        <button type="button" onclick="startCamera()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            üé• ÈñãÂïüÁõ∏Ê©üÊéÉÊèè
                        </button>
                        <button type="button" onclick="document.getElementById('formFileInput').click()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                            üìÇ ‰∏äÂÇ≥ QR Code ÂúñÁâá
                        </button>
                        <input type="file" id="formFileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
                        <button type="button" onclick="loadSampleData()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                            üìã ËºâÂÖ•ÁØÑ‰æãË≥áÊñô
                        </button>
                        <button type="button" id="check-update-btn" onclick="checkForUpdate()" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);">
                            üîÑ Êõ¥Êñ∞Á®ãÂºè
                        </button>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Âü∫Êú¨Ë≥áË®ä Basic Information</h3>
                    <div class="form-grid">
                        <div class="form-group form-group-justify">
                            <label for="patientBattleRoster">Êà∞ÂÇ∑Á∑®Ëôü Battle Roster:</label>
                            <input type="text" id="patientBattleRoster" name="patientBattleRoster" placeholder="Ëº∏ÂÖ•Êà∞Â†¥ÂÇ∑ÊÇ£Á∑®Ëôü" required>
                        </div>
                        <div class="form-group form-group-justify">
                            <label>ÂßìÂêç Name</label>
                            <input type="text" id="name" required>
                        </div> 
                        <div class="form-group-wrapper">
                            <div class="form-group form-group-justify">
                                <label>ID Êú´4Á¢º  Last 4</label>
                                <input type="text" id="idLast4" required>
                            </div>
                            <div class="form-group form-group-justify">
                                <label>Ë°ÄÂûã Blood Type</label>
                                <select id="bloodType" required>
                                    <option value="">ÈÅ∏ÊìáË°ÄÂûã</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group-wrapper">
                            <div class="form-group form-group-justify">
                                <label for="service">ËªçÁ®Æ SERVICE</label>
                                <input type="text" id="service" placeholder="‰æãÂ¶ÇÔºöÈô∏Ëªç„ÄÅÊµ∑Ëªç">
                            </div>
                            <div class="form-group form-group-justify">
                                <label for="unit">ÂñÆ‰Ωç UNIT</label>
                                <input type="text" id="unit" placeholder="‰æãÂ¶ÇÔºöÊ≠•ÂÖµ101ÊóÖ">
                            </div>
                        </div>
                        <div class="form-group form-group-justify">
                            <label>ÈÅéÊïèÂè≤ Allergies</label>
                            <input type="text" id="allergies" placeholder="ÁÑ°ÈÅéÊïèË´ãÂ°´ NKDA">
                        </div>
                    </div>
                </div>

                <!-- ÂÖ∂‰ªñË°®ÂñÆÂçÄÂ°ä‰øùÊåÅ‰∏çËÆä -->
                <div class="form-section">
                    <h3>ÂÇ∑Âã¢Ë©ï‰º∞ Injury Assessment</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ÂèóÂÇ∑ÊôÇÈñì Time of Injury</label>
                            <input type="datetime-local" id="injuryTime" required>
                        </div>
                        <div class="form-group">
                            <label>ÂèóÂÇ∑Ê©üÂà∂ Mechanism of Injury</label>
                            <select id="mechanism" required>
                                <option value="">ÈÅ∏Êìá</option>
                                <option value="GSW">ÊßçÂÇ∑ GSW</option>
                                <option value="IED">ÁàÜÁÇ∏ IED</option>
                                <option value="RPG">ÁÅ´ÁÆ≠ÂΩà RPG</option>
                                <option value="MVC">ËªäÁ¶ç MVC</option>
                                <option value="Fall">Â¢úËêΩ Fall</option>
                                <option value="Other">ÂÖ∂‰ªñ Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="injury-section">
                        <div class="form-group">
                            <label>ÂÇ∑Âã¢ÈÉ®‰Ωç Injury Location</label>
                            <div class="body-diagram">
                                <p style="color: #718096;">Ë∫´È´îÈÉ®‰ΩçÁ§∫ÊÑèÂúñ</p>
                                <div class="treatment-checklist">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="head" name="injury">
                                        <label for="head">È†≠ÈÉ® Head</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="neck" name="injury">
                                        <label for="neck">È†∏ÈÉ® Neck</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="chest" name="injury">
                                        <label for="chest">ËÉ∏ÈÉ® Chest</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="abdomen" name="injury">
                                        <label for="abdomen">ËÖπÈÉ® Abdomen</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="leftArm" name="injury">
                                        <label for="leftArm">Â∑¶ËáÇ L-Arm</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="rightArm" name="injury">
                                        <label for="rightArm">Âè≥ËáÇ R-Arm</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="leftLeg" name="injury">
                                        <label for="leftLeg">Â∑¶ËÖø L-Leg</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="rightLeg" name="injury">
                                        <label for="rightLeg">Âè≥ËÖø R-Leg</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ÂÇ∑Âã¢ÊèèËø∞ Injury Description</label>
                            <textarea id="injuryDescription" placeholder="Ë©≥Á¥∞ÊèèËø∞ÂÇ∑Âã¢..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>ÁîüÂëΩÂæµË±° Vital Signs</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ËÑàÊêè Pulse (bpm)</label>
                            <input type="number" id="pulse" min="0" max="300">
                        </div>
                        <div class="form-group">
                            <label>Ë°ÄÂ£ì Blood Pressure (mmHg)</label>
                            <input type="text" id="bloodPressure" placeholder="120/80">
                        </div>
                        <div class="form-group">
                            <label>ÂëºÂê∏ Respiratory Rate (bpm)</label>
                            <input type="number" id="respRate" min="0" max="60">
                        </div>
                        <div class="form-group">
                            <label>Ë°ÄÊ∞ß SpO2 (%)</label>
                            <input type="number" id="spo2" min="0" max="100">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Ê≤ªÁôÇÊé™ÊñΩ Treatments</h3>
                    <div class="treatment-checklist">
                        <div class="checkbox-group">
                            <input type="checkbox" id="tourniquet" name="treatment">
                            <label for="tourniquet">Ê≠¢Ë°ÄÂ∏∂ Tourniquet</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="chestSeal" name="treatment">
                            <label for="chestSeal">ËÉ∏Â∞Å Chest Seal</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="npa" name="treatment">
                            <label for="npa">ÈºªÂíΩÁÆ° NPA</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="decompress" name="treatment">
                            <label for="decompress">ËÉ∏ËÖîÊ∏õÂ£ì Needle Decompression</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="iv" name="treatment">
                            <label for="iv">ÈùúËÑàËº∏Ê∂≤ IV/IO</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="morphine" name="treatment">
                            <label for="morphine">ÂóéÂï° Morphine</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="antibiotics" name="treatment">
                            <label for="antibiotics">ÊäóÁîüÁ¥† Antibiotics</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="hypothermia" name="treatment">
                            <label for="hypothermia">‰øùÊ∫´ Hypothermia Prevention</label>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <label>ÂÖ∂‰ªñÊ≤ªÁôÇ Other Treatments</label>
                        <textarea id="otherTreatments" placeholder="ÂÖ∂‰ªñÊ≤ªÁôÇÊé™ÊñΩ..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>ÂæåÈÄÅË≥áË®ä Evacuation Info</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ÂæåÈÄÅÂÑ™ÂÖàÁ¥ö Evacuation Priority</label>
                            <select id="evacPriority" required>
                                <option value="">ÈÅ∏Êìá</option>
                                <option value="Urgent">Á∑äÊÄ• Urgent</option>
                                <option value="Priority">ÂÑ™ÂÖà Priority</option>
                                <option value="Routine">‰æãË°å Routine</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ÊïëË≠∑Âì° Medic Name</label>
                            <input type="text" id="medicName" required>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit">ÁîüÊàê QR Code</button>
                    <button type="button" onclick="clearForm()">Ê∏ÖÈô§Ë°®ÂñÆ</button>
                </div>
            </form>
        </div>

        <div class="card output-section" id="outputSection" style="display: none;">
             <h3>üìä ËôïÁêÜÁµêÊûú</h3>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="originalSize">0</div>
                    <div class="stat-label">ÂéüÂßãÂ§ßÂ∞è (bytes)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="compressedSize">0</div>
                    <div class="stat-label">Â£ìÁ∏ÆÂæåÂ§ßÂ∞è (bytes)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="compressionRatio">0%</div>
                    <div class="stat-label">Â£ìÁ∏ÆÁéá</div>
                </div>
            </div>

            <h4 style="margin-top: 20px;">ÁµêÊßãÂåñË≥áÊñô (JSON)</h4>
            <div class="data-display" id="jsonData"></div>
            
            <h4>COSE Sign1 Á∞ΩÁ´†Ë≥áÊñô (Binary)</h4>
            <div class="data-display" id="signedData"></div>
            
            <h4>Base45 Á∑®Á¢º</h4>
            <div class="data-display" id="base45Data"></div>
            
            <h4>QR Code</h4>
            <div id="qrcode"></div>
            
            <div class="button-group">
                <button onclick="downloadQRCode()">‰∏ãËºâ QR Code</button>
                <button onclick="verifyData()">È©óË≠âÁ∞ΩÁ´†</button>
            </div>
        </div>

        <div class="card" id="scanResult" style="display: none; margin-top: 20px;">
             <div id="decodedData"></div>
        </div>
    </div>

    <div id="update-notification" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #2d3748; color: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 1000; align-items: center;">
        <span style="margin-right: 20px;">ÊúâÊñ∞ÁâàÊú¨ÂèØÁî®ÔºÅ</span>
        <button id="update-button" style="background: #667eea; border: none; color: white; padding: 8px 15px; border-radius: 5px; cursor: pointer;">Á´ãÂç≥Êõ¥Êñ∞</button>
    </div>

    <div id="version-display" style="position: fixed; bottom: 5px; right: 10px; font-size: 12px; color: rgba(255, 255, 255, 0.5); z-index: 1001;">
        Loading version...
    </div>

    <!-- ÂºïÂÖ•Â§ñÈÉ® JavaScript -->
    <script src="app.js"></script>

</body>
</html>
