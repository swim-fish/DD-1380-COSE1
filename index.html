<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DD Form 1380 TCCC Êï∏‰ΩçÁ∞ΩÁ´† QR Code Á≥ªÁµ±</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    
    <!-- ÂºïÂÖ•Ëá™Ë®ÇÂ§ñÈÉ® CSS (Âú® Bootstrap ‰πãÂæå) -->
    <link rel="stylesheet" href="style.css">

    <!-- Â§ñÈÉ®ÂáΩÂºèÂ∫´ (‰øùÊåÅ‰∏çËÆä) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/3.45.1/minified.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.21.3/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cbor-x@1.6.0/dist/index.min.js"></script>
    
</head>
<body>
    <div id="videoContainer" style="display: none;">
        <video id="video"></video>
        <button onclick="stopCamera()" style="margin-top: 20px; background: #e53e3e;">ÈóúÈñâÁõ∏Ê©ü</button>
    </div>

    <div class="container">
        <h1>DD Form 1380 TCCC Êï∏‰ΩçÁ∞ΩÁ´† QR Code Á≥ªÁµ±</h1>
        
        <div class="card">
            <form id="tcccForm">
                <div class="form-section" style="background: #f0f9ff; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                    <h3 style="text-align: center; color: #0369a1; margin-bottom: 15px;">Âø´ÈÄüÊìç‰Ωú</h3>
                    <div class="button-group">
                        <button type="button" onclick="startCamera()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            üé• ÈñãÂïüÁõ∏Ê©üÊéÉÊèè
                        </button>
                        <button type="button" onclick="document.getElementById('formFileInput').click()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                            üìÇ ‰∏äÂÇ≥ QR Code ÂúñÁâá
                        </button>
                        <input type="file" id="formFileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
                        <button type="button" onclick="loadSampleData()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                            üìã ËºâÂÖ•ÁØÑ‰æãË≥áÊñô
                        </button>
                        <button type="button" id="check-update-btn" onclick="checkForUpdate()" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);">
                            üîÑ Êõ¥Êñ∞Á®ãÂºè
                        </button>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Âü∫Êú¨Ë≥áË®ä Basic Information</h3>
                    <div class="form-grid">
                        <div class="form-group form-group-justify">
                            <label for="patientBattleRoster">Êà∞ÂÇ∑Á∑®Ëôü (Battle Roster):</label>
                            <input type="text" id="patientBattleRoster" name="patientBattleRoster" placeholder="Ëº∏ÂÖ•Êà∞Â†¥ÂÇ∑ÊÇ£Á∑®Ëôü" required>
                        </div>
                        <div class="form-group form-group-justify">
                            <label>ÂßìÂêç Name</label>
                            <input type="text" id="name" required>
                        </div>
                        
                        <div class="form-group-wrapper">
                            <div class="form-group form-group-justify">
                                <label>ID Êú´4Á¢º  Last 4</label>
                                <input type="text" id="idLast4" required>
                            </div>
                            <div class="form-group form-group-justify">
                                <label>Ë°ÄÂûã Blood Type</label>
                                <select id="bloodType" required>
                                    <option value="">ÈÅ∏ÊìáË°ÄÂûã</option>
                                    <option value="A+">A+</option> <option value="A-">A-</option>
                                    <option value="B+">B+</option> <option value="B-">B-</option>
                                    <option value="AB+">AB+</option> <option value="AB-">AB-</option>
                                    <option value="O+">O+</option> <option value="O-">O-</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group-wrapper">
                            <div class="form-group form-group-justify">
                                <label for="service">ËªçÁ®Æ SERVICE</label>
                                <input type="text" id="service" placeholder="‰æãÂ¶ÇÔºöÈô∏Ëªç„ÄÅÊµ∑Ëªç">
                            </div>
                            <div class="form-group form-group-justify">
                                <label for="unit">ÂñÆ‰Ωç UNIT</label>
                                <input type="text" id="unit" placeholder="‰æãÂ¶ÇÔºöÊ≠•ÂÖµ101ÊóÖ">
                            </div>
                        </div>
                        
                        <div class="form-group form-group-justify">
                            <label>ÈÅéÊïèÂè≤ Allergies</label>
                            <input type="text" id="allergies" placeholder="ÁÑ°ÈÅéÊïèË´ãÂ°´ NKDA">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>ÂÇ∑Âã¢Ë©ï‰º∞ Injury Assessment</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ÂèóÂÇ∑ÊôÇÈñì Time of Injury</label>
                            <input type="datetime-local" id="injuryTime" required>
                        </div>
                        <div class="form-group">
                            <label>ÂèóÂÇ∑Ê©üÂà∂ Mechanism of Injury</label>
                            <select id="mechanism" required>
                                <option value="">ÈÅ∏ÊìáÊ©üÂà∂</option>
                                <option value="Artillery">Á†≤Êìä Artillery</option> <option value="Burn">ÁáíÁáôÂÇ∑ Burn</option>
                                <option value="Fall">Â¢úËêΩ Fall</option> <option value="Grenade">ÊâãÊ¶¥ÂΩà Grenade</option>
                                <option value="GSW">ÊßçÂÇ∑ GSW</option> <option value="IED">ÁàÜÁÇ∏Ë£ùÁΩÆ IED</option>
                                <option value="Landmine">Âú∞Èõ∑ Landmine</option> <option value="MVC">ËªäËºõ‰∫ãÊïÖ MVC</option>
                                <option value="RPG">ÁÅ´ÁÆ≠ÂΩà RPG</option> <option value="Other">ÂÖ∂‰ªñ Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- START: Êñ∞Â¢ûÊ≠¢Ë°ÄÂ∏∂Á¥ÄÈåÑÂçÄÂ°ä -->
                    <div class="form-section" style="margin-top: 20px;">
                        <h4>Ê≠¢Ë°ÄÂ∏∂Á¥ÄÈåÑ (Tourniquet Application)</h4>
                        <div class="tourniquet-section">
                            <div class="container text-center">
                                <div class="row">
                                    <div class="col">
                                        <!-- TQ Left Arm -->
                                        <div class="tq-record">
                                            <label for="tq_l_arm_type">TQ: Left Arm</label>
                                            <div class="tq-record-inputs">
                                                <input type="text" id="tq_l_arm_type" list="tq-types" placeholder="Type">
                                                <input type="time" id="tq_l_arm_time">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <!-- TQ Right Arm -->
                                        <div class="tq-record">
                                            <label for="tq_r_arm_type">TQ: Right Arm</label>
                                            <div class="tq-record-inputs">
                                                <input type="text" id="tq_r_arm_type" list="tq-types" placeholder="Type">
                                                <input type="time" id="tq_r_arm_time">
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <!-- TQ Left Leg -->
                                        <div class="tq-record">
                                            <label for="tq_l_leg_type">TQ: Left Leg</label>
                                            <div class="tq-record-inputs">
                                                <input type="text" id="tq_l_leg_type" list="tq-types" placeholder="Type">
                                                <input type="time" id="tq_l_leg_time">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <!-- TQ Right Leg -->
                                        <div class="tq-record">
                                            <label for="tq_r_leg_type">TQ: Right Leg</label>
                                            <div class="tq-record-inputs">
                                                <input type="text" id="tq_r_leg_type" list="tq-types" placeholder="Type">
                                                <input type="time" id="tq_r_leg_time">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <datalist id="tq-types">
                            <option value="CAT"></option>
                            <option value="SAM"></option>
                        </datalist>
                    </div>
                    <!-- END: Êñ∞Â¢ûÊ≠¢Ë°ÄÂ∏∂Á¥ÄÈåÑÂçÄÂ°ä -->

                    <div class="form-group" style="margin-top: 20px;">
                        <label>ÂÇ∑Âã¢ÊèèËø∞ Injury Description</label>
                        <textarea id="injuryDescription" placeholder="Ë©≥Á¥∞ÊèèËø∞ÂÇ∑Âã¢..."></textarea>
                    </div>
                </div>

                <!-- ÂÖ∂‰ªñË°®ÂñÆÂçÄÂ°ä... -->
                <div class="form-section">
                    <h3>ÁîüÂëΩÂæµË±° Vital Signs</h3>
                    <div class="form-grid">
                        <div class="form-group"><label>ËÑàÊêè Pulse (bpm)</label><input type="number" id="pulse" min="0" max="300"></div>
                        
                        
                        <!-- <div class="form-group"><label>Ë°ÄÂ£ì Blood Pressure (mmHg)</label><input type="text" id="bloodPressure" placeholder="120/80"></div> -->
                        <div class="form-group">
                            <label>Ë°ÄÂ£ì Blood Pressure (mmHg)</label>
                            
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" placeholder="Systolic 120" aria-label="Systolic (mmHg)" id="bloodPressureSystolic">
                                <span class="input-group-text">/</span>
                                <input type="text" class="form-control" placeholder="Diastolic 80" aria-label="Diastolic (mmHg)" id="bloodPressureDiastolic">
                            </div>
                        </div>
                        <div class="form-group"><label>ÂëºÂê∏ Respiratory Rate (bpm)</label><input type="number" id="respRate" min="0" max="60"></div>
                        <div class="form-group"><label>Ë°ÄÊ∞ß SpO2 (%)</label><input type="number" id="spo2" min="0" max="100"></div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Ê≤ªÁôÇÊé™ÊñΩ Treatments</h3>
                    <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
                        <input type="checkbox" class="btn-check" name="btnradio" id="tourniquet" autocomplete="off">
                        <label class="btn btn-outline-primary" for="tourniquet">Ê≠¢Ë°ÄÂ∏∂ Tourniquet</label>
                        
                        <input type="checkbox" class="btn-check" name="btnradio" id="chestSeal" autocomplete="off">
                        <label class="btn btn-outline-primary" for="chestSeal">ËÉ∏Â∞Å Chest Seal</label>

                        <input type="checkbox" class="btn-check" name="btnradio" id="npa" autocomplete="off">
                        <label class="btn btn-outline-primary" for="npa">ÈºªÂíΩÁÆ° NPA</label>
                        
                        <input type="checkbox" class="btn-check" name="btnradio" id="decompress" autocomplete="off">
                        <label class="btn btn-outline-primary" for="decompress">ËÉ∏ËÖîÊ∏õÂ£ì Needle Decompression</label>
                        
                        <input type="checkbox" class="btn-check" name="btnradio" id="iv" autocomplete="off">
                        <label class="btn btn-outline-primary" for="iv">ÈùúËÑàËº∏Ê∂≤ IV/IO</label>

                        <input type="checkbox" class="btn-check" name="btnradio" id="morphine" autocomplete="off">
                        <label class="btn btn-outline-primary" for="morphine">ÂóéÂï° Morphine</label>
                        
                        <input type="checkbox" class="btn-check" name="btnradio" id="antibiotics" autocomplete="off">
                        <label class="btn btn-outline-primary" for="antibiotics">ÊäóÁîüÁ¥† Antibiotics</label>

                        <input type="checkbox" class="btn-check" name="btnradio" id="hypothermia" autocomplete="off">
                        <label class="btn btn-outline-primary" for="hypothermia">‰øùÊ∫´ Hypothermia Prevention</label>
                    </div>
                    <div class="form-group" style="margin-top: 15px;"><label>ÂÖ∂‰ªñÊ≤ªÁôÇ Other Treatments</label><textarea id="otherTreatments" placeholder="ÂÖ∂‰ªñÊ≤ªÁôÇÊé™ÊñΩ..."></textarea></div>
                </div>

                <div class="form-section">
                    <h3>ÂæåÈÄÅË≥áË®ä Evacuation Info</h3>
                    <div class="form-grid">
                        <div class="form-group"><label>ÂæåÈÄÅÂÑ™ÂÖàÁ¥ö Evacuation Priority</label><select id="evacPriority" required><option value="">ÈÅ∏Êìá</option><option value="Urgent">Á∑äÊÄ• Urgent</option><option value="Priority">ÂÑ™ÂÖà Priority</option><option value="Routine">‰æãË°å Routine</option></select></div>
                        <div class="form-group"><label>ÊïëË≠∑Âì° Medic Name</label><input type="text" id="medicName" required></div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit">ÁîüÊàê QR Code</button>
                    <button type="button" onclick="clearForm()">Ê∏ÖÈô§Ë°®ÂñÆ</button>
                </div>
            </form>
        </div>

        <div class="card output-section" id="outputSection" style="display: none;">
            <h3>üìä ËôïÁêÜÁµêÊûú</h3>
            <div class="stats">
                <table class="table">
                    <thead>
                        <tr>
                        <th scope="col"></th>
                        <th scope="col">ÂéüÂßãÂ§ßÂ∞è (bytes)</th>
                        <th scope="col">Â£ìÁ∏ÆÂæåÂ§ßÂ∞è (bytes)</th>
                        <th scope="col">ÊúÄÁµÇ QR Code Â§ßÂ∞è (bytes)</th>
                        <th scope="col">Â£ìÁ∏ÆÁéá</th>
                        </tr>
                    </thead>
                    <tbody class="table-group-divider">
                        <tr>
                        <th scope="row"></th>
                        <td><div class="stat-value" id="originalSize">0</div></td>
                        <td><div class="stat-value" id="compressedSize">0</div></td>
                        <td><div class="stat-value" id="qrDataSize">0</div></td>
                        <td><div class="stat-value" id="compressionRatio">0%</div></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4 style="margin-top: 20px;">ÁµêÊßãÂåñË≥áÊñô (JSON)</h4>
            <div class="data-display" id="jsonData"></div>
            
            <h4>COSE Sign1 Á∞ΩÁ´†Ë≥áÊñô (Binary)</h4>
            <div class="data-display" id="signedData"></div>
            
            <h4>Base45 Á∑®Á¢º</h4>
            <div class="data-display" id="base45Data"></div>
            
            <h4>QR Code</h4>
            <div id="qrcode" class="text-center"></div>
            
            <div class="button-group">
                <button onclick="downloadQRCode()">‰∏ãËºâ QR Code</button>
                <button onclick="verifyData()">È©óË≠âÁ∞ΩÁ´†</button>
            </div>
        </div>

        <div class="card" id="scanResult" style="display: none; margin-top: 20px;">
             <div id="decodedData"></div>
        </div>
    </div>

    <div id="update-notification" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #2d3748; color: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 1000; align-items: center;">
        <span style="margin-right: 20px;">ÊúâÊñ∞ÁâàÊú¨ÂèØÁî®ÔºÅ</span>
        <button id="update-button" style="background: #667eea; border: none; color: white; padding: 8px 15px; border-radius: 5px; cursor: pointer;">Á´ãÂç≥Êõ¥Êñ∞</button>
    </div>

    <div id="version-display" style="position: fixed; bottom: 5px; right: 10px; font-size: 12px; color: rgba(255, 255, 255, 0.5); z-index: 1001;">
        Loading version...
    </div>

    <!-- START: Êñ∞Â¢û Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <!-- END: Êñ∞Â¢û Bootstrap JS -->

    <!-- ÂºïÂÖ•Â§ñÈÉ® JavaScript -->
    <script src="app.js"></script>

</body>
</html>

